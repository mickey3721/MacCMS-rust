{% extends "base.html" %}

{% block title %}{{ video.vod_name }} - {{ SITENAME | default(value="maccms-rust") }}{% endblock %}

{% block description %}{{ video.vod_name }}{% if video.vod_year %}({{ video.vod_year }}){% endif %} - {% if
video.vod_area %}{{ video.vod_area }}{% endif %}{{ video.vod_director }}导演，{{ video.vod_actor }}主演。{{ video.vod_content
| striptags | truncate(length=100) }} - {{ SITENAME }}{% endblock %}

{% block keywords %}{{ video.vod_name }},在线观看,免费观看,{{ video.vod_year }},{{ video.vod_area }},{{ video.vod_director }},{{
video.vod_actor }},{{ SITEKEYWORDS | default(value="") }}{% endblock %}

{% block content %}
<!-- 电影详情头部 -->
<header class="movie-header py-6 md:py-12 px-4 md:px-6">
    <div class="absolute inset-0 bg-black/30"></div>
    <div class="container mx-auto max-w-6xl px-4 md:px-6 relative z-10">
        <div class="flex flex-col lg:flex-row gap-6 md:gap-8">
            <!-- 电影海报 -->
            <div class="w-full lg:w-1/4 mx-auto max-w-xs mb-4 md:mb-0">
                <div class="poster-container aspect-[2/3]">
                    <img src="{{ video.vod_pic | default(value='https://images.unsplash.com/photo-1536440136628-849c177e76a1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80') }}"
                        alt="{{ video.vod_name }}" class="w-full h-full object-cover">
                    <div class="absolute bottom-0 left-0 right-0 z-10 p-4 text-white">
                        <div class="flex flex-wrap gap-2 mb-2">
                            <span class="bg-primary px-3 py-1 rounded-full text-xs font-bold">{% if category %}{{
                                category.type_name }}{% else %}{{ video.vod_class | default(value="未知") }}{% endif
                                %}</span>
                            {% if video.vod_year %}<span class="bg-rose-600 px-3 py-1 rounded-full text-xs font-bold">{{
                                video.vod_year }}</span>{% endif %}
                            {% if video.vod_area %}<span
                                class="bg-purple-600 px-3 py-1 rounded-full text-xs font-bold">{{ video.vod_area
                                }}</span>{% endif %}
                        </div>
                        <h3 class="text-xl font-bold">HD</h3>
                    </div>
                </div>
            </div>

            <!-- 电影信息 -->
            <div class="w-full lg:w-2/3">
                <h1 class="mobile-text-2xl md:text-4xl lg:text-5xl font-bold text-white mb-2">{{ video.vod_name }}</h1>

                <div class="flex flex-wrap items-center gap-3 mb-4 md:mb-6">
                    {% if video.vod_year %}<span class="bg-cyan-600 px-3 py-1 rounded-full text-sm font-medium">{{
                        video.vod_year }}</span>{% endif %}
                    {% if video.vod_area %}<span class="bg-amber-600 px-3 py-1 rounded-full text-sm font-medium">{{
                        video.vod_area }}</span>{% endif %}
                    <span class="bg-rose-600 px-3 py-1 rounded-full text-sm font-medium">{% if category %}{{
                        category.type_name }}{% else %}{{ video.vod_class | default(value="未知") }}{% endif %}</span>
                </div>

                {% if video.vod_director %}
                <div class="mb-4 md:mb-6">
                    <h2 class="mobile-text-xl font-semibold mb-3 flex items-center">
                        <i class="fas fa-video text-primary mr-2"></i>导演
                    </h2>
                    <div class="cast-scroll overflow-x-auto pb-3 flex gap-2">
                        {% set directors = video.vod_director | split(pat=",") %}
                        {% for director in directors %}
                        <span class="bg-card-bg px-3 py-1 rounded-full text-sm whitespace-nowrap">{{ director | trim
                            }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if video.vod_actor %}
                <div class="mb-4 md:mb-6">
                    <h2 class="mobile-text-xl font-semibold mb-3 flex items-center">
                        <i class="fas fa-users text-primary mr-2"></i>主演
                    </h2>
                    <div class="cast-scroll overflow-x-auto pb-3 flex gap-2">
                        {% set actors = video.vod_actor | split(pat=",") %}
                        {% for actor in actors %}
                        <span class="bg-card-bg px-3 py-1 rounded-full text-sm whitespace-nowrap">{{ actor | trim
                            }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <div class="flex flex-wrap gap-3 mb-4 md:mb-6">
                    {% if video.vod_play_urls and video.vod_play_urls | length > 0 %}
                    <a href="/play/{{ video._id }}/0-0"
                        class="play-btn bg-primary hover:bg-rose-500 text-white px-6 py-3 md:px-8 rounded-full font-bold text-base md:text-lg flex items-center justify-center mobile-btn w-full md:w-auto">
                        <i class="fas fa-play mr-2"></i>立即播放
                    </a>
                    {% endif %}
                    <button
                        class="bg-card-bg hover:bg-slate-700 text-white px-4 py-3 md:px-6 rounded-full font-medium flex items-center justify-center mobile-btn-sm w-full md:w-auto">
                        <i class="fas fa-share-alt mr-2"></i>分享
                    </button>
                </div>

                <div class="text-secondary flex items-center text-sm md:text-base">
                    <i class="fas fa-sync-alt mr-2"></i>
                    <span>更新:
                        {% if video.vod_pubdate and video.vod_pubdate['$date'] and
                        video.vod_pubdate['$date']['$numberLong'] %}
                        <script>document.write(new Date(parseInt('{{ video.vod_pubdate["$date"]["$numberLong"] }}')).toLocaleDateString('zh-CN'));</script>
                        {% else %}
                        未知
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- 主要内容区域 -->
<main class="container mx-auto max-w-6xl px-4 md:px-6 py-8 md:py-10">
    <!-- 剧情简介 -->
    <section class="bg-card-bg rounded-2xl p-5 md:p-6 mb-6 md:mb-10 shadow-xl">
        <h2 class="mobile-text-xl md:text-2xl font-bold mb-4 flex items-center">
            <i class="fas fa-book-open text-primary mr-3"></i>剧情简介
        </h2>
        <p class="mobile-text-lg leading-relaxed text-gray-300">
            {{ video.vod_content | safe }}
        </p>
    </section>

    <!-- 播放源 -->
    <section class="bg-card-bg rounded-2xl p-5 md:p-6 mb-6 md:mb-10 shadow-xl">
        <h2 class="mobile-text-xl md:text-2xl font-bold mb-4 md:mb-6 flex items-center">
            <i class="fas fa-play-circle text-primary mr-3"></i>播放源
        </h2>

        <!-- 播放源选项卡 -->
        <div class="mb-4 border-b border-slate-700">
            <div class="flex flex-wrap -mb-px">
                {% if video.vod_play_urls and video.vod_play_urls | length > 0 %}
                {% for source in video.vod_play_urls %}
                <button
                    class="tab-btn {% if loop.first %}active{% endif %} px-3 py-2 md:px-4 font-medium border-b-2 {% if loop.first %}border-primary text-primary{% else %}border-transparent text-secondary hover:text-white{% endif %} transition-colors text-sm md:text-base">
                    {{ source.source_name | default(value='播放源' ~ loop.index) }}
                </button>
                {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- 播放源内容 -->
        <div class="space-y-4">
            {% if video.vod_play_urls and video.vod_play_urls | length > 0 %}
            {% for source in video.vod_play_urls %}
            {% set source_index = loop.index0 %}
            <div class="tab-content {% if not loop.first %}hidden{% endif %}">
                <div
                    class="max-h-96 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-primary scrollbar-track-slate-800">
                    <div class="flex flex-wrap gap-2">
                        {% for url_info in source.urls %}
                        {% set episode_index = loop.index0 %}
                        <a href="/play/{{ video._id['$oid'] }}/{{ source_index }}-{{ episode_index }}"
                            class="bg-slate-800 rounded px-3 py-2 hover:bg-slate-700 transition-colors">{{ url_info.name
                            | default(value='第' ~ loop.index ~ '集') }}</a>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </div>
    </section>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
        <!-- 左侧：详细信息 -->
        <div class="lg:col-span-1">
            <div class="bg-card-bg rounded-2xl p-5 md:p-6 shadow-xl mb-6 md:mb-8">
                <h2 class="mobile-text-xl md:text-2xl font-bold mb-4 md:mb-6 flex items-center">
                    <i class="fas fa-info-circle text-primary mr-3"></i>详细信息
                </h2>
                <div class="space-y-3">
                    <div class="info-item flex justify-between">
                        <span class="text-secondary text-sm md:text-base">语言:</span>
                        <span class="font-medium text-sm md:text-base">{{ video.vod_lang | default(value="未知") }}</span>
                    </div>
                    <div class="info-item flex justify-between">
                        <span class="text-secondary text-sm md:text-base">类型:</span>
                        <span class="font-medium text-sm md:text-base">{% if category %}{{ category.type_name }}{% else
                            %}{{ video.vod_class | default(value="未知") }}{% endif %}</span>
                    </div>
                    <div class="info-item flex justify-between">
                        <span class="text-secondary text-sm md:text-base">状态:</span>
                        <span class="font-medium text-sm md:text-base">{{ video.vod_remarks }}</span>
                    </div>
                    <div class="info-item flex justify-between">
                        <span class="text-secondary text-sm md:text-base">更新:</span>
                        <span class="font-medium text-sm md:text-base">
                            {% if video.vod_pubdate and video.vod_pubdate['$date'] and
                            video.vod_pubdate['$date']['$numberLong'] %}
                            <script>document.write(new Date(parseInt('{{ video.vod_pubdate["$date"]["$numberLong"] }}')).toLocaleDateString('zh-CN'));</script>
                            {% else %}
                            未知
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右侧：相关推荐 -->
        <div class="lg:col-span-2">
            <div class="bg-card-bg rounded-2xl p-5 md:p-6 shadow-xl">
                <h2 class="mobile-text-xl md:text-2xl font-bold mb-4 md:mb-6 flex items-center">
                    <i class="fas fa-thumbs-up text-primary mr-3"></i>相关推荐
                </h2>
                {% if related_videos %}
                <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">
                    {% for related in related_videos | slice(end=6) %}
                    <div
                        class="movie-card bg-gray-800/50 rounded-xl overflow-hidden border border-gray-700/50 hover:border-red-500/50 transition-all duration-300 group">
                        <a href="/detail/{{ related._id['$oid'] }}" class="block">
                            <div class="relative aspect-[2/3] overflow-hidden">
                                <img src="{{ related.vod_pic | default(value='https://images.unsplash.com/photo-1536440136628-849c177e76a1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80') }}"
                                    alt="{{ related.vod_name }}"
                                    class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110">
                                <div
                                    class="absolute top-2 right-2 bg-primary text-white text-xs font-bold px-2 py-1 rounded">
                                    {{ related.vod_remarks | default(value='HD') }}</div>
                                <div
                                    class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-3 text-white">
                                    <div class="flex justify-between items-center text-xs">
                                        <span>{{ related.vod_year }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3">
                                <h3 class="text-white font-medium text-sm mb-1 line-clamp-2">{{ related.vod_name }}</h3>
                                <div class="flex items-center justify-between text-xs text-gray-400">
                                    <span>{{ related.vod_year }}</span>
                                    <span>{{ related.vod_area }}</span>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 md:py-12">
                    <div class="text-gray-400 text-sm md:text-base">暂无相关推荐</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</main>

<!-- 回到顶部按钮 -->
<button id="backToTop"
    class="fixed bottom-6 right-6 bg-primary text-white p-3 rounded-full shadow-lg hover:bg-rose-500 transition-colors opacity-0 invisible transition-all duration-300">
    <i class="fas fa-arrow-up"></i>
</button>

{% block extra_js %}
<script>
    // 模拟加载动画
    document.querySelectorAll('.fade-in').forEach((el, index) => {
        el.style.animationDelay = `${index * 0.1}s`;
    });

    // 播放源选项卡切换
    const detailTabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    detailTabBtns.forEach((btn, index) => {
        btn.addEventListener('click', () => {
            // 移除所有按钮和内容的active类
            detailTabBtns.forEach(btn => {
                btn.classList.remove('active', 'border-primary', 'text-primary');
                btn.classList.add('border-transparent', 'text-secondary');
            });
            tabContents.forEach(content => content.classList.add('hidden'));

            // 添加active类到当前按钮和内容
            btn.classList.add('active', 'border-primary', 'text-primary');
            btn.classList.remove('border-transparent', 'text-secondary');
            tabContents[index].classList.remove('hidden');
        });
    });
</script>
{% endblock %}
{% endblock %}